# Telegram Mini App - Digital Garden

Минималистичный digital garden встроенный в Telegram как Mini App с поддержкой приватных статей.

## Возможности

- ✅ Создание сайта из markdown заметок с гиперссылками
- ✅ Интеграция с Telegram WebApp API
- ✅ Приватные статьи (доступ только для авторизованных пользователей Telegram)
- ✅ Защита от копирования текста
- ✅ Запрет масштабирования страницы
- ✅ Стили в стиле Telegram/Apple
- ✅ Callouts с скругленными углами (12px)
- ✅ Работа с папкой `src/site/notes` как с Obsidian vault

## Настройка

### 1. Установка зависимостей

```bash
npm install
```

### 2. Настройка переменных окружения

### 3. Настройка приватных статей

Для создания приватной статьи добавьте в frontmatter файла:

```markdown
---
access: private
---

Содержимое статьи...
```

**Логика доступа:**
- `access: private` - статья доступна только для пользователей, открывших приложение через Telegram (любые авторизованные пользователи)
- `access: public` или без указания - статья доступна всем

### 4. Настройка в Vercel

1. Переменные окружения не требуются для базовой работы
2. Убедитесь, что проект использует Node.js 20.x

## Использование папки notes как Obsidian Vault

### Настройка Obsidian

1. Откройте Obsidian
2. Выберите "Open folder as vault"
3. Укажите путь: `src/site/notes` (относительно корня проекта)
4. Теперь вы можете работать с заметками напрямую в Obsidian

### Структура заметок

Все `.md` файлы в папке `src/site/notes` автоматически обрабатываются и публикуются на сайте.

**Пример структуры:**
```
src/site/notes/
├── index.md              # Главная страница (index: true)
├── Запросы.md
├── Кейсы.md
├── Методика.md
└── Моя биография.md
```

### Frontmatter для статей

**Публичная статья:**
```yaml
---
title: "Публичная статья"
access: "public"
permalink: "Запросы"  # Без слэшей - они добавляются автоматически
---
```
`permalink` определяет URL статьи. Если указан `permalink: "Запросы"`, то URL будет `/Запросы/`. Этот permalink также используется в ссылке для шаринга (вместо длинного пути).

**Приватная статья:**
```yaml
---
title: "Приватная статья"
access: "private"
permalink: "Приватная"  # Без слэшей
---
```

**Главная страница:**
```yaml
---
title: "Главная"
access: "public"
index: true  # Указывает, что это главная страница
---
```
Для главной страницы используйте `index: true` вместо `permalink`. URL будет `/`.

**Статья без permalink (используется имя файла):**
```yaml
---
title: "Статья"
access: "public"
---
```
Если `permalink` не указан, используется имя файла. Если файл называется `Кейсы.md`, то URL будет `/notes/Кейсы/`.

### Синтаксис ссылок

Используйте стандартный синтаксис Obsidian для внутренних ссылок:

```markdown
[[Название статьи]]           # Ссылка на статью
[[Название статьи|Текст ссылки]]  # Ссылка с кастомным текстом
[[Название статьи#Заголовок]]  # Ссылка на заголовок в статье
```

### Callouts

Используйте синтаксис Obsidian callouts:

```markdown
> [!info] Заголовок
> Содержимое callout

> [!warning]+ Раскрытый callout
> Содержимое

> [!tip]- Свёрнутый callout
> Содержимое
```

**Доступные типы callouts:**
- `info`, `todo`
- `tip`, `hint`, `important`
- `success`, `check`, `done`
- `question`, `help`, `faq`
- `warning`, `caution`, `attention`
- `failure`, `fail`, `missing`
- `danger`, `error`
- `bug`
- `example`
- `quote`, `cite`
- `abstract`, `summary`, `tldr`


## Запуск локально

```bash
npm start
```

Сайт будет доступен по адресу `http://localhost:8080`

## Сборка

```bash
npm run build
```

Собранный сайт будет в папке `dist/`

## Структура проекта

```
garden/
├── api/                        # API функции (если нужны в будущем)
├── src/
│   └── site/
│       ├── _includes/
│       │   ├── components/
│       │   │   ├── accessGate.njk      # Компонент проверки доступа
│       │   │   └── telegramAuth.njk   # Компонент защиты от копирования
│       │   └── layouts/
│       │       └── index.njk            # Основной layout
│       └── notes/                      # Markdown заметки (ваш Obsidian vault)
└── vercel.json                 # Конфигурация Vercel
```

## Защита контента

Приложение использует несколько уровней защиты:
- Telegram WebApp API (`disableSelection()`)
- Meta viewport (`user-scalable=no`)
- CSS (`user-select: none`)
- JavaScript (блокировка событий копирования)

## Стили

Интерфейс выполнен в стиле Telegram/Apple:
- Скругленные углы (12px для callouts, 8px для мелких элементов)
- Цветовая схема Telegram
- Плавные анимации
- Адаптивный дизайн

## Рабочий процесс

1. **Создание/редактирование статей:**
   - Откройте папку `src/site/notes` в Obsidian
   - Создавайте и редактируйте `.md` файлы
   - Используйте стандартный синтаксис Obsidian

2. **Публикация:**
   - Запустите `npm run build` для сборки
   - Или используйте `npm start` для разработки с автоперезагрузкой

3. **Деплой:**
   - Push в репозиторий
   - Vercel автоматически соберёт и задеплоит сайт

## Лицензия

ISC
