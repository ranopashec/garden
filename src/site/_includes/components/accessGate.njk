{% if access == "private" %}
  <div class="access-gate" data-article-path="{{ page.url }}">
    <div class="access-checking">
      <div class="access-spinner"></div>
      <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞...</p>
    </div>
    <div class="access-denied" style="display: none;">
      <div class="access-denied-icon">üîí</div>
      <h2>–î–æ—Å—Ç—É–ø –æ–≥—Ä–∞–Ω–∏—á–µ–Ω</h2>
      <p>–≠—Ç–∞ —Å—Ç–∞—Ç—å—è –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º Telegram</p>
    </div>
    <div class="article-content" style="display: none;">
      {{ content | hideDataview | link | safe }}
    </div>
  </div>
{% else %}
  {{ content | hideDataview | link | safe }}
{% endif %}

<script>
(function() {
  const accessGate = document.querySelector('.access-gate');
  if (!accessGate) return;
  
  const checkingEl = accessGate.querySelector('.access-checking');
  const deniedEl = accessGate.querySelector('.access-denied');
  const contentEl = accessGate.querySelector('.article-content');
  
  function checkAccess() {
    const tg = window.Telegram?.WebApp;
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Telegram WebApp –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (tg) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º initData (—Å—Ç—Ä–æ–∫–∞) –∏–ª–∏ initDataUnsafe (–æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
      const hasInitData = tg.initData && tg.initData.length > 0;
      const hasUserData = tg.initDataUnsafe?.user && 
                         (tg.initDataUnsafe.user.id || tg.initDataUnsafe.user.username);
      
      if (hasInitData || hasUserData) {
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –≤ Telegram - —Ä–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø
        checkingEl.style.display = 'none';
        deniedEl.style.display = 'none';
        contentEl.style.display = 'block';
        return true;
      }
    }
    
    return false;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
  if (checkAccess()) {
    return;
  }
  
  // –ï—Å–ª–∏ –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª–æ, –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ Telegram WebApp
  let checkCount = 0;
  const maxChecks = 50; // 5 —Å–µ–∫—É–Ω–¥ (50 * 100ms)
  
  const checkInterval = setInterval(() => {
    checkCount++;
    
    if (checkAccess()) {
      clearInterval(checkInterval);
      return;
    }
    
    // –ï—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –ø—Ä–æ–≤–µ—Ä–æ–∫ - –∑–∞–ø—Ä–µ—â–∞–µ–º –¥–æ—Å—Ç—É–ø
    if (checkCount >= maxChecks) {
      clearInterval(checkInterval);
      checkingEl.style.display = 'none';
      deniedEl.style.display = 'block';
      contentEl.style.display = 'none';
    }
  }, 100);
  
  // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
  window.addEventListener('load', () => {
    setTimeout(() => {
      if (checkAccess()) {
        clearInterval(checkInterval);
      }
    }, 500);
  });
})();
</script>

