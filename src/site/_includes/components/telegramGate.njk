<div id="telegram-gate" style="display: block;">
  <div class="telegram-gate-overlay">
    <div class="telegram-gate-content">
      <div class="telegram-gate-icon">üì±</div>
      <h1 class="telegram-gate-title">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram</h1>
      <p class="telegram-gate-message">
        –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Telegram Mini App.
        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –≤ Telegram.
      </p>
      {% if meta.botUsername %}
      <a href="https://t.me/{{ meta.botUsername }}" class="telegram-gate-button" target="_blank">
        –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram
      </a>
      {% endif %}
    </div>
  </div>
</div>

<script>
(function() {
  let accessGranted = false;
  
  function checkTelegramAccess() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Telegram WebApp
    const hasTelegram = !!window.Telegram?.WebApp;
    
    // –¢–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–∞–º–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ Telegram (–º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–æ WebApp –µ—â—ë –Ω–µ—Ç)
    const hasTelegramObject = !!window.Telegram;
    
    console.log('TelegramGate: Checking access');
    console.log('TelegramGate: window.Telegram exists?', hasTelegramObject);
    console.log('TelegramGate: window.Telegram.WebApp exists?', hasTelegram);
    
    if (hasTelegram) {
      // Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω - —Ä–∞–∑—Ä–µ—à–∞–µ–º –¥–æ—Å—Ç—É–ø
      accessGranted = true;
      const telegramGate = document.getElementById('telegram-gate');
      const mainContent = document.querySelector('main.content');
      
      if (telegramGate) {
        telegramGate.style.display = 'none';
      }
      if (mainContent) {
        mainContent.style.display = 'block';
      }
      
      console.log('TelegramGate: ‚úÖ Access granted - Telegram WebApp available');
      return true;
    } else if (hasTelegramObject) {
      // Telegram –æ–±—ä–µ–∫—Ç –µ—Å—Ç—å, –Ω–æ WebApp –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω - –∂–¥—ë–º
      console.log('TelegramGate: ‚è≥ Telegram object exists, waiting for WebApp...');
      return false;
    } else {
      // Telegram –Ω–µ –Ω–∞–π–¥–µ–Ω - –±–ª–æ–∫–∏—Ä—É–µ–º –¥–æ—Å—Ç—É–ø
      if (!accessGranted) {
        const telegramGate = document.getElementById('telegram-gate');
        const mainContent = document.querySelector('main.content');
        const userInfo = document.getElementById('user-info');
        
        if (telegramGate) {
          telegramGate.style.display = 'block';
        }
        if (mainContent) {
          mainContent.style.display = 'none';
        }
        if (userInfo) {
          userInfo.style.display = 'none';
        }
        
        console.warn('TelegramGate: ‚ùå Access denied - Telegram WebApp not available');
      }
      return false;
    }
  }
  
  // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏
  function initTelegramGate() {
    // –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ä–∞–∑—É
    if (checkTelegramAccess()) {
      return; // –î–æ—Å—Ç—É–ø –ø–æ–ª—É—á–µ–Ω, –≤—ã—Ö–æ–¥–∏–º
    }
    
    // –ï—Å–ª–∏ –Ω–µ –ø–æ–ª—É—á–∏–ª–∏ –¥–æ—Å—Ç—É–ø, –ø—Ä–æ–±—É–µ–º –µ—â—ë –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å —É–≤–µ–ª–∏—á–∏–≤–∞—é—â–∏–º–∏—Å—è –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
    const delays = [100, 300, 500, 1000, 2000, 3000];
    
    delays.forEach((delay, index) => {
      setTimeout(() => {
        if (!accessGranted) {
          console.log(`TelegramGate: Attempt ${index + 2} after ${delay}ms`);
          if (checkTelegramAccess()) {
            accessGranted = true;
          }
        }
      }, delay);
    });
    
    // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    setTimeout(() => {
      if (!accessGranted) {
        console.warn('TelegramGate: Final check after 5 seconds');
        checkTelegramAccess();
      }
    }, 5000);
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTelegramGate);
  } else {
    // –ï—Å–ª–∏ DOM —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω, –∑–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É
    initTelegramGate();
  }
  
  // –¢–∞–∫–∂–µ —Å–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∫—Ä–∏–ø—Ç–∞ Telegram (–µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å)
  window.addEventListener('load', () => {
    setTimeout(() => {
      if (!accessGranted) {
        console.log('TelegramGate: Checking after window.load event');
        checkTelegramAccess();
      }
    }, 100);
  });
})();
</script>
