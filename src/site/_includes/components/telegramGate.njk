<div id="telegram-gate" style="display: none;">
  <div class="telegram-gate-overlay">
    <div class="telegram-gate-content">
      <div class="telegram-gate-icon">üì±</div>
      <h1 class="telegram-gate-title">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Telegram</h1>
      <p class="telegram-gate-message">
        –≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ Telegram Mini App.
        –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞ –≤ Telegram.
      </p>
      {% if meta.botUsername %}
      <a href="https://t.me/{{ meta.botUsername }}" class="telegram-gate-button" target="_blank">
        –û—Ç–∫—Ä—ã—Ç—å –≤ Telegram
      </a>
      {% endif %}
    </div>
  </div>
</div>

<script>
(function() {
  function checkTelegramAccess() {
    const hasTelegram = !!window.Telegram?.WebApp;
    const telegramGate = document.getElementById('telegram-gate');
    const mainContent = document.querySelector('main.content');
    
    console.log('TelegramGate: Checking access, hasTelegram:', hasTelegram);
    
    if (!hasTelegram) {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫–∏—Ä—É—é—â–∏–π —ç–∫—Ä–∞–Ω
      if (telegramGate) {
        telegramGate.style.display = 'block';
      }
      // –°–∫—Ä—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
      if (mainContent) {
        mainContent.style.display = 'none';
      }
      // –°–∫—Ä—ã–≤–∞–µ–º user-info
      const userInfo = document.getElementById('user-info');
      if (userInfo) {
        userInfo.style.display = 'none';
      }
      console.warn('TelegramGate: Access denied - Telegram WebApp not available');
      return false;
    } else {
      // –°–∫—Ä—ã–≤–∞–µ–º –±–ª–æ–∫–∏—Ä—É—é—â–∏–π —ç–∫—Ä–∞–Ω
      if (telegramGate) {
        telegramGate.style.display = 'none';
      }
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç
      if (mainContent) {
        mainContent.style.display = 'block';
      }
      console.log('TelegramGate: Access granted - Telegram WebApp available');
      return true;
    }
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ä–∞–∑—É
  function initTelegramGate() {
    checkTelegramAccess();
    
    // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏ (–Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ Telegram –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ)
    setTimeout(() => {
      if (!checkTelegramAccess()) {
        // –ï—Å–ª–∏ –ø–æ—Å–ª–µ 500–º—Å –≤—Å—ë –µ—â—ë –Ω–µ—Ç Telegram, –ø—Ä–æ–≤–µ—Ä—è–µ–º –µ—â—ë —Ä–∞–∑ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
        setTimeout(checkTelegramAccess, 2000);
      }
    }, 500);
  }
  
  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTelegramGate);
  } else {
    initTelegramGate();
  }
})();
</script>

