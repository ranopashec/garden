<div id="debug-members" style="display: none; margin-top: 40px; padding: 20px; background-color: var(--background-secondary); border-radius: var(--tg-radius); border-top: 2px solid var(--text-accent);">
  <h3 style="color: var(--text-accent); margin-top: 0;">üîç –û—Ç–ª–∞–¥–∫–∞: –£—á–∞—Å—Ç–Ω–∏–∫–∏ –≥—Ä—É–ø–ø—ã</h3>
  <div id="debug-members-content">
    <p style="opacity: 0.7;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
  </div>
</div>

<script>
(function() {
  if (!window.Telegram?.WebApp) {
    return;
  }
  
  const tg = window.Telegram.WebApp;
  const initData = tg.initData;
  
  if (!initData) {
    return;
  }
  
  const debugContainer = document.getElementById('debug-members');
  const debugContent = document.getElementById('debug-members-content');
  
  if (!debugContainer || !debugContent) {
    return;
  }
  
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
  debugContainer.style.display = 'block';
  
  // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  fetch('/api/group-members', {
    method: 'POST',
    headers: { 
      'Content-Type': 'application/json' 
    },
    body: JSON.stringify({ initData })
  })
  .then(async res => {
    const contentType = res.headers.get('content-type');
    let errorData = null;
    
    if (!res.ok) {
      // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å JSON —Å –¥–µ—Ç–∞–ª—è–º–∏ –æ—à–∏–±–∫–∏
      if (contentType && contentType.includes('application/json')) {
        errorData = await res.json();
      }
      throw new Error(`HTTP ${res.status}: ${errorData?.error || res.statusText}`);
    }
    return res.json();
  })
  .then(data => {
    console.log('Debug members:', data);
    
    if (data.members && data.members.length > 0) {
      let html = `<p><strong>–ì—Ä—É–ø–ø–∞:</strong> ${data.groupIdentifier}</p>`;
      html += `<p><strong>–ù–∞–π–¥–µ–Ω–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</strong> ${data.count}</p>`;
      html += '<ul style="list-style: none; padding: 0; margin: 16px 0;">';
      
      data.members.forEach(member => {
        const username = member.username ? `@${member.username}` : (member.first_name || '–ë–µ–∑ username');
        const name = member.first_name || member.title || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        const status = member.status || member.type || 'unknown';
        
        html += `<li style="padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">`;
        html += `<strong>${name}</strong> `;
        html += `<span style="opacity: 0.7;">(${username})</span> `;
        html += `<span style="opacity: 0.5; font-size: 0.9em;">[${status}]</span>`;
        html += `</li>`;
      });
      
      html += '</ul>';
      debugContent.innerHTML = html;
    } else {
      debugContent.innerHTML = '<p style="opacity: 0.7;">–£—á–∞—Å—Ç–Ω–∏–∫–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
    }
  })
  .catch(error => {
    console.error('Error fetching group members:', error);
    debugContent.innerHTML = `<p style="color: #f06449;">–û—à–∏–±–∫–∞: ${error.message}</p>`;
    if (error.message.includes('500')) {
      debugContent.innerHTML += '<p style="opacity: 0.7; font-size: 0.9em; margin-top: 8px;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞. –í–æ–∑–º–æ–∂–Ω–æ, –±–æ—Ç –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ –≥—Ä—É–ø–ø—É –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤.</p>';
    }
  });
})();
</script>

